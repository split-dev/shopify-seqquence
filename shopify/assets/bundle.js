!function(){var t={757:function(e,t,r){e.exports=r(666)},666:function(e){var t=function(e){"use strict";var t,r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var o=t&&t.prototype instanceof m?t:m,a=Object.create(o.prototype),i=new A(n||[]);return a._invoke=function(e,t,r){var n=f;return function(o,a){if(n===h)throw new Error("Generator is already running");if(n===d){if("throw"===o)throw a;return P()}for(r.method=o,r.arg=a;;){var i=r.delegate;if(i){var c=E(i,r);if(c){if(c===g)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===f)throw n=d,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=h;var s=l(e,t,r);if("normal"===s.type){if(n=r.done?d:p,s.arg===g)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(n=d,r.method="throw",r.arg=s.arg)}}}(e,r,i),a}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var f="suspendedStart",p="suspendedYield",h="executing",d="completed",g={};function m(){}function v(){}function y(){}var w={};s(w,a,(function(){return this}));var b=Object.getPrototypeOf,x=b&&b(b(_([])));x&&x!==r&&n.call(x,a)&&(w=x);var L=y.prototype=m.prototype=Object.create(w);function j(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function S(e,t){function r(o,a,i,c){var s=l(e[o],e,a);if("throw"!==s.type){var u=s.arg,f=u.value;return f&&"object"==typeof f&&n.call(f,"__await")?t.resolve(f.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(f).then((function(e){u.value=e,i(u)}),(function(e){return r("throw",e,i,c)}))}c(s.arg)}var o;this._invoke=function(e,n){function a(){return new t((function(t,o){r(e,n,t,o)}))}return o=o?o.then(a,a):a()}}function E(e,r){var n=e.iterator[r.method];if(n===t){if(r.delegate=null,"throw"===r.method){if(e.iterator.return&&(r.method="return",r.arg=t,E(e,r),"throw"===r.method))return g;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return g}var o=l(n,e.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,g;var a=o.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function _(e){if(e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}return{next:P}}function P(){return{value:t,done:!0}}return v.prototype=y,s(L,"constructor",y),s(y,"constructor",v),v.displayName=s(y,c,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,s(e,c,"GeneratorFunction")),e.prototype=Object.create(L),e},e.awrap=function(e){return{__await:e}},j(S.prototype),s(S.prototype,i,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new S(u(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},j(L),s(L,c,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=_,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(O),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var s=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),O(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;O(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:_(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),g}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}}},r={};function n(e){var o=r[e];if(void 0!==o)return o.exports;var a=r[e]={exports:{}};return t[e](a,a.exports,n),a.exports}n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){"use strict";document.addEventListener("DOMContentLoaded",(function(){window.console.log("Hello from main.js ðŸ‘‹.");var e=document.querySelector("#menu-drawer"),t=document.querySelector("#Details-menu-drawer-container");window.onclick=function(r){r.target!=e&&t.classList.remove("menu-opening")}}))}(),function(){"use strict";function t(e,t,r,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}function r(e){return function(){var r=this,n=arguments;return new Promise((function(o,a){var i=e.apply(r,n);function c(e){t(i,o,a,c,s,"next",e)}function s(e){t(i,o,a,c,s,"throw",e)}c(void 0)}))}}var o=n(757),a=n.n(o);!function(){var t,n="ai-search",o=document.getElementById("aiSearch"),i=document.querySelector(".js-get-new-prompt"),c=document.querySelectorAll(".js-search-view"),s=localStorage.getItem(n),u="https://lime-filthy-duckling.cyclic.app",l=s?JSON.parse(s):{},f=function(e){return new Promise((function(t){return setTimeout(t,e)}))},p={},h=new Map,d=new URL(document.location).searchParams.get("search")||"",g="on"===new URL(document.location).searchParams.get("preventAutoExtend"),m=document.querySelectorAll(".js-search-view .search__wrapper");if(o&&c.length){var v=function(e){window.gtag&&window.gtag("event","error",{event_category:"Replicate AI ERROR",event_label:"Images request error",value:e})},y=function(e){m=document.querySelectorAll(".js-search-view .search__wrapper"),e.forEach((function(e,t){e.error?v(e.error):h.get(e.prompt)?h.set(e.prompt,Object.assign({},h.get(e.prompt),e.images)):h.set(e.prompt,e.images)}));var t=h.keys();Array.from(t).forEach((function(e,t){var r=h.get(e);p[t]=p[t]||{},Object.keys(r).forEach((function(n){r[n]&&r[n].tShirtResult?p[t][n]=r[n].tShirtResult:v("There is no image result for search query: ".concat(e," and id: ").concat(n))})),m[t]||(!function(){var e=document.querySelector(".js-search-dom-template"),t=e.content.cloneNode(!0),r=i.closest(".js-search-view");e.before(t);var n=r.querySelector(".js-search-swiper:not(.swiper-initialized)");window.Swiper&&new Swiper(n,{slidesPerView:3.5,spaceBetween:30,freeMode:!0,mousewheel:!0,breakpoints:{767:{slidesPerView:3.5},320:{slidesPerView:1.2}},navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"}})}(),m=document.querySelectorAll(".js-search-view .search__wrapper"));var n=m[t].querySelector(".js-search-swiper"),o=m[t].querySelector(".js-search-prompt"),a=m[t].querySelector(".js-generate-more"),c=n.getAttribute("data-mockup-src");n.getAttribute("data-mockup-url");o&&(o.textContent=e),a&&a.setAttribute("data-prompt",e),n&&(Object.keys(p[t]).forEach((function(e,r){var o=n.querySelectorAll(".swiper-slide")[r];o?(o.querySelector("IMG").setAttribute("src",p[t][e]),o.querySelector(".js-get-product-redirect").setAttribute("data-id","".concat(e)),o.classList.add("customized")):n.swiper.appendSlide('<div class="swiper-slide customized"><img src="'.concat(p[t][e],'" onerror="this.src=').concat(c,'" /><button data-id="').concat(e,'" class="btn btn--secondary js-get-product-redirect button button--secondary"><span>Buy</span></button></div>'))})),n.swiper.slides[n.swiper.slides.length-1].classList.contains("customized")&&n.swiper.appendSlide('<div class="swiper-slide"><img src="'.concat(c,'" /><button class="btn btn--secondary js-get-product-redirect button button--secondary"><span>Buy</span></button></div>')),n.swiper.slideTo(n.swiper.slides.length))})),console.log("FULL imagesResult :>> ",p)},w=function(){var e=r(a().mark((function e(t,r){var n,o,i,c,s;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=r||1e4,i=0,c=0;case 3:if(!(c<270)){e.next=25;break}return e.next=6,fetch("".concat(u,"/image?requestId=").concat(t.join(",")),{method:"GET"});case 6:return s=e.sent,e.next=9,s.json();case 9:if(n=e.sent,200===s.status){e.next=14;break}return console.error(n),v("Error images request ".concat(JSON.stringify(n))),e.abrupt("return",n);case 14:if(console.log("imagesResponse",n),a=t.length,(l=n).length!==a||!l.every((function(e){return e.images&&Object.keys(e.images).length&&Object.keys(e.images).every((function(t){return e.images[t].printifyId}))}))){e.next=17;break}return e.abrupt("break",25);case 17:return n.length>i&&(y(n),i=n.length),console.log("pending images...next ping in ".concat(o/1e3," seconds")),e.next=21,f(o);case 21:o=1e3;case 22:c+=1,e.next=3;break;case 25:return 0===n.length&&v("Can't get images. Probably DB connection error"),y(n),e.abrupt("return",n);case 28:case"end":return e.stop()}var a,l}),e)})));return function(t,r){return e.apply(this,arguments)}}(),b=function(){var e=r(a().mark((function e(t,r){var o,i,c;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(u,"/prompt"),{method:"POST",headers:{"Access-Control-Allow-Origin":"*","Content-Type":"application/json"},body:JSON.stringify((a={preventAutoExtend:g},s=r?"fullPrompt":"prompt",f=t,s in a?Object.defineProperty(a,s,{value:f,enumerable:!0,configurable:!0,writable:!0}):a[s]=f,a))});case 2:return o=e.sent,e.next=5,o.json();case 5:if(i=e.sent,201===o.status){e.next=9;break}return console.error(i),e.abrupt("return",!1);case 9:return c=i.map((function(e){return e.id})),i.map((function(e){return e.input.prompt})).forEach((function(e,t){l[d]=l[d]||{},l[d]&&(l[d][e]?l[d][e].push(c[t]):l[d][e]=[c[t]])})),localStorage.setItem(n,JSON.stringify(l)),e.next=15,w(c);case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}var a,s,f}),e)})));return function(t,r){return e.apply(this,arguments)}}(),x=function(){var t=r(a().mark((function t(n,o,i){var c,s,l,f;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("".concat(u,"/printify-product"),{method:"POST",headers:{"Access-Control-Allow-Origin":"*","Content-Type":"application/json"},body:JSON.stringify({imageId:n,type:"t-shirt",prompt:o,number:i+1})});case 2:return c=t.sent,t.next=5,c.json();case 5:if((s=t.sent).id){t.next=10;break}return console.error(s),j(e.target,!1),t.abrupt("return",!1);case 10:console.log("response",s),l="/products/".concat(s.title.toLowerCase().replace(/[^a-z|0-9]+/gim,"-")),100,f=function(){var e=r(a().mark((function e(){var t,r,n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(l,".js"),{method:"GET"});case 2:if(200!==(t=e.sent).status){e.next=10;break}return e.next=6,t.json();case 6:(n=e.sent).available&&n.featured_image&&null!==(r=n.images)&&void 0!==r&&r.length?document.location.href=l:setTimeout(f,1e3),e.next=11;break;case 10:setTimeout(f,1e3);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),f();case 15:case"end":return t.stop()}}),t)})));return function(e,r,n){return t.apply(this,arguments)}}(),L=function(e,t){var r=e.querySelector("SPAN");t?(e.classList.add("loading"),r&&(r.textContent="Loading...")):(e.classList.remove("loading"),r&&(r.textContent="Create More of this Style"))},j=function(e,t){var r=e.querySelector("SPAN");t?(e.classList.add("loading"),r&&(r.textContent="Wait...")):(e.classList.remove("loading"),r&&(r.textContent="Buy"))},S=function(){m.forEach((function(e){e.classList.remove("loading")}))};if(d.length){if(l[d]){var E=Object.values(l[d]).reduce((function(e,t){return e.concat(t)}),[]);w(E,1).then((function(e){S(),console.log("Got images from LS :>> ",e)}))}else b(d,!1,1).then((function(e){return e})).then((function(e){S(),console.log("Got images from Replicate API :>> ",e)}));document.querySelector(".search").addEventListener("click",(function(e){e.target.classList.contains("js-get-product-redirect")&&(j(e.target,!0),x(e.target.getAttribute("data-id"),e.target.closest(".search__wrapper").querySelector(".js-search-prompt").innerHTML,Array.from(e.target.closest(".swiper-slide").parentNode.children).indexOf(e.target.closest(".swiper-slide"))))})),c.forEach((function(e,t){e.addEventListener("click",(function(e){if(e.target.classList.contains("js-generate-more")||e.target.closest(".js-generate-more")){var t=e.target.closest(".js-generate-more")?e.target.closest(".js-generate-more"):e.target;if(t.classList.contains("loading"))return!1;L(t,!0),b(t.getAttribute("data-prompt"),!0).then((function(e){return e})).then((function(e){L(t,!1),console.log("Got images from Replicate API :>> ",e)}))}}))})),i&&i.addEventListener("click",r(a().mark((function e(){var r,n,o,c;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!i.classList.contains("loading")){e.next=2;break}return e.abrupt("return",!1);case 2:if(L(i,!0),t){e.next=13;break}return e.next=6,fetch("".concat(u,"/available-prompts?prompt=").concat(d),{method:"GET",headers:{"Access-Control-Allow-Origin":"*","Content-Type":"application/json"}});case 6:return r=e.sent,e.next=9,r.json();case 9:if(t=e.sent,200===r.status){e.next=13;break}return console.error(t),e.abrupt("return",!1);case 13:o=0;case 14:if(!(o<t.length)){e.next=21;break}if(h.get(t[o])){e.next=18;break}return n=t[o],e.abrupt("break",21);case 18:o+=1,e.next=14;break;case 21:n||(c=Math.floor(Math.random()*t.length),n=t[c]),b(n,!0).then((function(e){return e})).then((function(e){L(i,!1),console.log("Got images from Replicate API :>> ",e)}));case 23:case"end":return e.stop()}}),e)}))))}o.querySelector('input[name="search"]').value=d,o.querySelector('input[name="preventAutoExtend"]').checked=g}}()}()}();